---
phase: 04-ios-shortcut
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - frontend/app/page.tsx
autonomous: true

must_haves:
  truths:
    - "Web UI loads recipe from URL query param without user input"
    - "URL with recipe param shows checklist immediately"
    - "URL without recipe param shows input form"
    - "Malformed recipe param shows error, not crash"
  artifacts:
    - path: "frontend/app/page.tsx"
      provides: "URL query param recipe loading"
      contains: "useSearchParams"
  key_links:
    - from: "frontend/app/page.tsx"
      to: "URL searchParams"
      via: "useSearchParams hook and base64 decoding"
      pattern: "useSearchParams.*recipe"
---

<objective>
Add URL query parameter support to the frontend so iOS Shortcut can open the web UI with recipe data pre-loaded.

Purpose: Enable stateless recipe sharing via URL - the Shortcut encodes recipe JSON in URL params, frontend decodes and displays immediately without API call.

Output: Modified page.tsx that checks for `?recipe=` on load and renders checklist if present.
</objective>

<execution_context>
@/Users/bharadwajkulkarni/.claude/get-shit-done/workflows/execute-plan.md
@/Users/bharadwajkulkarni/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-ios-shortcut/04-CONTEXT.md

@frontend/app/page.tsx
@frontend/lib/types.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add URL query param recipe loading</name>
  <files>frontend/app/page.tsx</files>
  <action>
Modify page.tsx to check for recipe data in URL query params on initial load:

1. Import `useSearchParams` from `next/navigation`
2. In the Home component, use `useSearchParams()` to get query params
3. Check for `recipe` param on component mount (useEffect)
4. If present:
   - Base64 decode the param value
   - JSON parse the decoded string
   - Validate it has required Recipe fields (title, sections, ingredients)
   - If valid, call setRecipe() with the parsed recipe
   - If invalid, set an error state
5. If not present, normal flow continues (show input form)

Important details:
- Use `atob()` for base64 decoding (browser native)
- Wrap decode/parse in try-catch for malformed data
- Show user-friendly error if decode fails: "Invalid recipe link"
- Clear the URL query param after loading (use router.replace) to prevent stale state on refresh
- Do NOT automatically clear localStorage recipe - URL recipe is additive
- Only run URL check once on mount (empty deps array for useEffect)

Pattern:
```typescript
const searchParams = useSearchParams();

useEffect(() => {
  const recipeParam = searchParams.get('recipe');
  if (recipeParam) {
    try {
      const decoded = atob(recipeParam);
      const parsed = JSON.parse(decoded) as Recipe;
      // Validate required fields
      if (parsed.title && parsed.sections && parsed.ingredients) {
        setRecipe(parsed);
      } else {
        setError('Invalid recipe data');
      }
    } catch {
      setError('Invalid recipe link');
    }
  }
}, []);
```

Note: Since page.tsx is a client component ('use client'), useSearchParams will work directly. No need for Suspense boundary for this use case.
  </action>
  <verify>
Build passes: `cd frontend && npm run build`
Test manually:
1. Open `http://localhost:3000` - should show input form
2. Open `http://localhost:3000?recipe=eyJ0aXRsZSI6IlRlc3QiLCJzZWN0aW9ucyI6W3sibmFtZSI6IlByZXAiLCJzdGVwcyI6W3siaWQiOiIxIiwidGV4dCI6IlRlc3Qgc3RlcCIsImNvbXBsZXRlZCI6ZmFsc2V9XX1dLCJpbmdyZWRpZW50cyI6W119` - should show checklist with "Test" recipe
3. Open `http://localhost:3000?recipe=invalid` - should show error message
  </verify>
  <done>URL with valid base64 recipe shows checklist immediately, invalid recipe shows error, no recipe shows input form</done>
</task>

</tasks>

<verification>
- [ ] `npm run build` succeeds in frontend/
- [ ] URL without params shows input form
- [ ] URL with valid recipe param shows checklist
- [ ] URL with invalid recipe param shows error
- [ ] URL with malformed base64 shows error (doesn't crash)
</verification>

<success_criteria>
Frontend accepts recipe data via URL query param, enabling iOS Shortcut to open web UI with pre-loaded recipe. Invalid params show error instead of crashing.
</success_criteria>

<output>
After completion, create `.planning/phases/04-ios-shortcut/04-01-SUMMARY.md`
</output>
