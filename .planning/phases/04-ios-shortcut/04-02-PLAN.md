---
phase: 04-ios-shortcut
plan: 02
type: execute
wave: 2
depends_on: ["04-01"]
files_modified:
  - docs/ios-shortcut-guide.md
autonomous: false

must_haves:
  truths:
    - "User can build iOS Shortcut by following guide"
    - "Shortcut appears in share sheet for audio files"
    - "Sharing Voice Memo to shortcut produces recipe on TRMNL and web"
    - "End-to-end flow takes under 30 seconds"
  artifacts:
    - path: "docs/ios-shortcut-guide.md"
      provides: "Step-by-step iOS Shortcut build instructions"
      contains: "Transcribe Audio"
  key_links:
    - from: "iOS Shortcut"
      to: "/api/recipe/parse"
      via: "Get Contents of URL POST"
      pattern: "POST.*transcript"
---

<objective>
Create a step-by-step guide for building the iOS Shortcut that transforms voice recordings into recipes.

Purpose: iOS Shortcuts are built visually in the Shortcuts app - Claude cannot create .shortcut files directly. This guide provides exact action-by-action instructions the user follows to build the Shortcut, then a checkpoint verifies it works.

Output: Documentation file with complete build instructions, plus user verification that end-to-end flow works.
</objective>

<execution_context>
@/Users/bharadwajkulkarni/.claude/get-shit-done/workflows/execute-plan.md
@/Users/bharadwajkulkarni/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-ios-shortcut/04-CONTEXT.md
@.planning/phases/04-ios-shortcut/04-RESEARCH.md
@.planning/phases/04-ios-shortcut/04-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create iOS Shortcut build guide</name>
  <files>docs/ios-shortcut-guide.md</files>
  <action>
Create a comprehensive guide for building the "Recipe" iOS Shortcut. The guide must be exact and followable - user should be able to build the shortcut without interpretation.

Structure the guide as:

## Overview
- What the shortcut does (voice memo -> recipe on TRMNL + web)
- Prerequisites (iOS 26+, deployed worker URL, deployed Vercel URL)

## Shortcut Settings
- Name: "Recipe"
- Show in Share Sheet: ON
- Share Sheet Types: Audio (from Media category)

## Actions (numbered, exact sequence)

**Action 1: Receive Input**
- Type: "Receive [Audio] input from Share Sheet"
- This is automatically added when enabling Share Sheet

**Action 2: Transcribe Audio**
- Search for "Transcribe Audio"
- Input: [Shortcut Input] (magic variable from Action 1)
- Output: Transcribed Text

**Action 3: URL (API endpoint)**
- Search for "URL"
- Enter: `https://[WORKER_URL]/api/recipe/parse`
- User replaces [WORKER_URL] with their deployed Cloudflare Worker URL

**Action 4: Get Contents of URL**
- Search for "Get Contents of URL"
- URL: [URL from Action 3]
- Method: POST
- Headers:
  - Content-Type: application/json
- Request Body: JSON
- JSON body:
  ```json
  {
    "transcript": "[Transcribed Text]"
  }
  ```
- Tap [Transcribed Text] to insert magic variable from Action 2

**Action 5: Get Dictionary from Input**
- Search for "Get Dictionary from Input"
- Input: [Contents of URL] (magic variable from Action 4)

**Action 6: If (error check)**
- Search for "If"
- Condition: [Dictionary] "has any value" for key "error"
- This checks if API returned an error

**Action 7: Show Alert (error case)**
- Inside the "If" block
- Search for "Show Alert"
- Title: "Recipe Error"
- Message: [Get Dictionary Value for "error"]

**Action 8: Otherwise**
- Below Show Alert, add "Otherwise" block
- This is the success path

**Action 9: Get Dictionary Value (extract recipe)**
- Inside "Otherwise" block
- Search for "Get Dictionary Value"
- Key: leave empty (get entire response as dictionary)
- Actually, we need the full recipe JSON as text for encoding

Alternative for Action 9-11:
Since we need to base64 encode the entire recipe JSON, simpler approach:

**Action 9: Text**
- Inside "Otherwise" block
- Search for "Text"
- Content: [Contents of URL] (the raw JSON response)
- This preserves the full JSON as text

**Action 10: Base64 Encode**
- Search for "Base64 Encode"
- Input: [Text from Action 9]
- Mode: Encode
- Line Breaks: None (important!)

**Action 11: Text (build URL)**
- Search for "Text"
- Content: `https://[VERCEL_URL]?recipe=[Base64 Encoded]`
- User replaces [VERCEL_URL] with their Vercel deployment URL
- Tap [Base64 Encoded] to insert magic variable from Action 10

**Action 12: Show Notification**
- Search for "Show Notification"
- Title: "Recipe sent!"
- Body: "Opening recipe..."

**Action 13: Open URL**
- Search for "Open URL"
- URL: [Text from Action 11]

**Action 14: End If**
- Close the If/Otherwise block

## Testing the Shortcut
1. Record a short Voice Memo describing a simple recipe
2. In Voice Memos app, tap Share on the recording
3. Select "Recipe" from share sheet
4. Wait for processing (may take 10-30 seconds for transcription)
5. Should see "Recipe sent!" notification
6. Safari should open with recipe checklist

## Troubleshooting
- "Transcription failed": Try a shorter, clearer recording
- "Recipe Error" alert: Check that Worker URL is correct and deployed
- Safari doesn't open: Check Vercel URL in Action 11
- No TRMNL update: TRMNL_WEBHOOK_URL may not be configured in Worker

## URLs to Configure
The user needs to replace these placeholders:
- [WORKER_URL]: Their deployed Cloudflare Worker (e.g., recipe-worker.username.workers.dev)
- [VERCEL_URL]: Their deployed Vercel app (e.g., recipe-manager.vercel.app)
  </action>
  <verify>
File exists: `cat docs/ios-shortcut-guide.md`
File contains all actions: grep for "Action 1", "Action 14", "Transcribe Audio", "Base64 Encode"
  </verify>
  <done>Guide created with all 14 actions documented step-by-step</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>iOS Shortcut guide for building the Recipe shortcut</what-built>
  <how-to-verify>
1. Open iOS Shortcuts app on your iPhone (requires iOS 26+)
2. Tap + to create new shortcut
3. Follow the guide in docs/ios-shortcut-guide.md exactly
4. Configure with your URLs:
   - Worker: Your deployed Cloudflare Worker URL
   - Vercel: Your deployed Vercel frontend URL
5. Test the shortcut:
   - Record a Voice Memo: "I want to make scrambled eggs. I'll need 2 eggs, some butter, and salt. First crack the eggs into a bowl and whisk them. Then melt butter in a pan, pour in the eggs, and stir until cooked."
   - Share the Voice Memo
   - Select "Recipe" shortcut
   - Wait for processing
   - Verify:
     - "Recipe sent!" notification appears
     - Safari opens with recipe checklist
     - TRMNL updates (if configured)
6. End-to-end should take under 30 seconds
  </how-to-verify>
  <resume-signal>Type "verified" if shortcut works end-to-end, or describe what failed</resume-signal>
</task>

</tasks>

<verification>
- [ ] docs/ios-shortcut-guide.md exists with complete instructions
- [ ] User confirms shortcut builds successfully
- [ ] User confirms Voice Memo -> Recipe flow works
- [ ] Total time under 30 seconds
</verification>

<success_criteria>
User has built and tested the iOS Shortcut. End-to-end flow from voice recording to displayed recipe works in under 30 seconds.
</success_criteria>

<output>
After completion, create `.planning/phases/04-ios-shortcut/04-02-SUMMARY.md`
</output>
